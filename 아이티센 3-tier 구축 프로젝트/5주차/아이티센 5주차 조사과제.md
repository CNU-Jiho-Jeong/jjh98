# 1. Zabbix란?

**1) 개요**

- 수많은 종류의 서버를 감시하고 추적하여 관리자에게 장애 발생을 신속히
알리기 위해 만들어진 네트워크 관리 시스템이다.
- 모니터링 시스템을 구축해서 장애가 생겼을 때 빠르게 대응할 수 있게
해준다.
- 사용, 수정, 연구 등의 제한이 없다.
- 서버, 네트워크 업무를 하는 사람에게 있어 굉장히 유용하다.
- 유연한 알람 메커니즘을 갖추고 있어 사용자는 모든 이벤트에 통지를
하도록 설정할 수 있다.
- 저장된 데이터를 바탕으로 보고서 및 데이터의 그래픽 표시 기능을
제공한다.
- 폴링, 트래핑을 모두 지원한다.
모든 보고서, 통계 및 구성 매개 변수는 웹 인터페이스를 통해 액세스할
수 있으며, 웹 인터페이스는 어떤 장소에서도 액세스할 네트워크나 서버의
상태를 확인할 수 있다.

![image](https://user-images.githubusercontent.com/108641325/196729309-d0a7fe6b-abd5-4e46-bfaa-17c0961d0cfc.png)

---

**2) 동작 방식**

- Active or Passive

#### Active (Agent → Server)
- Zabbix Agent 설정 파일에 serverActive 의 IP 지정. 해당 IP 를 참조하여
데이터를 전송한다.
- Active 는 활성이라는 뜻으로, 주기적으로 결과를 전송한다.

#### Passive (Server → Agent)
- Zabbix 동작방식은 Passive 가 기본.
- 요청이 있을 경우 데이터를 전송한다.

**폴링(Polling)**
- 하나의 장치(또는 프로그램)가 충돌회피 또는 동기화 처리 등을 목적으로
다른 장치(또는 프로그램)의 상태를 주기적으로 검사, 일정한 조건을
만족할 때 송수신 등의 자료처리를 하는 방식.

- 여러 개의 장치가 동일 회선을 사용하는 상황에서 주로 사용.

- 대부분의 실시간(처럼 보이는) 웹사이트들은 클라이언트가 서버에게 일정
주기를 가지고 응답을 주고받는 폴링 방식이라 할 수 있다.

- 문제점
  - 주기가 짧으면 서버 성능에 부담이 감.
  - 주기가 길면 실시간성이 떨어진다.

**트래핑(Trapping)**

- SNMP 는 수동적인 프로토콜로 Agent 는 Manager 가 요청해야지만 응답을
한다.

- SNMP Trap 은 Manager 의 요청이 없더라도 Agent 가 자의적으로
생성/송신하는 SNMP 메시지 중 하나이다.
이러한 SNMP Trap 은 주로 시스템이 다운되거나, 새로 부팅되는 경우 등을
전송할 때 사용된다.

- 규격으로 제공하는 메시지 외에도 관리자가 직접 정의하여 설정할 수도
있다.

---

(Poll: Manager 가 정보를 요청하며, Agent 측이 요청을 받아 응답하는 형식으로
관리된다.)

(Trap: 특정 이벤트에 대해 Agent 가 Manager 에게 직접 보내주는 방식이다)

![image](https://user-images.githubusercontent.com/108641325/196735318-002e3d47-cd8e-4cc7-9845-544c44eb11ba.png)

---

### Conf 파일 편집

- 패시브 에이전트를 사용할 때: Passive checks related or server
zabbix 서버에서 agent 로 호출되는 IP 로 입력되야함.

- 액티브 Item 을 사용할 때 액티브 아이템을 어디서 가져오는가에 대해
기입함.

- 기동할 때, 주기적으로 서버 액티브에서 수집되야하는 데이터를 받아서
가져오도록 함.

- Hostname 은 zabbix 서버에 등록된 이름과 같아야한다.

![image](https://user-images.githubusercontent.com/108641325/196735832-7ac93625-863d-4b4b-936a-4d01c959dca5.png)

- 패시브의 경우: zabbix 서버에서 agent 로 요청을 보낸다. 그 요청에 대해서
응답을 주는 방식

- 액티브의 경우: 액티브 서버에서 체크할 리스트를 에이전트가 서버로 요청.
서버에서는 그 항목들을 에이전트에서 수집해야되는지 목록을 주면
에이전트가 주기적으로 작업을 수행하면서 데이터를 수집하고, 그 정보를
서버로 보내주는 방식이다.

- 네트워크의 흐름 :
passive 의 경우 서버→에이전트 / active 의 경우 에이전트→서버

- 방화벽 등의 문제로 서버→에이전트 요청을 하기 어려울 때 active 방식을
사용하면 좋다.

- 방식의 차이고, 수집 항목의 차이는 아니다. 다만, 액티브 방식으로만
수집할 수 있는 정보들이 있다.

- 액티브를 사용할 때는 호스트네임과 서버액티브를 고려해야한다.

---

**3) 기능**

- 데이터 수집

  - 가용성 및 성능 검사

  - SNMP(트래핑 및 폴링), IPMI, JMX, VMware 모니터링 지원

  - 사용자 정의 검사

  - 사용자 정의 간격으로 원하는 데이터 수집

  - 서버 / 프록시 및 에이전트가 수행

  - 기본적으로 30 초마다 지표 수집, 인터벌을 조정할 수 있다.


- 유연한 임계 값 정의

  -  데이터베이스로부터 트리거, 참조값이라고 하는 매우 유연한 문제
임계값을 정의할 수 있다.

- 구성 가능한 알람

  - 에스컬레이션 일정, 받는 사람, 미디어 유형에 대한 보내는 알림을
사용자 지정할 수 있음.

  - 알림을 매크로 변수로 사용하여 의미 있고 도움이 될 수 있음.
  
  - 자동 작업에는 원격 명령이 포함됨.
  
  - 알림에 대해 구성을 고도화할 수 있으며, 사용자 정의 메시지를 이용해
알람 내용을 설정할 수 있다.

  - 쉘 스크립트를 사용, 알림을 쉽게 스크립트할 수 있음.

- 그래프 작업/ 다양한 시각화 옵션

  - 강력한 모니터링 기능과 그래프를 하나의 도구로 결합함.
  
  - 사용자 정의에 따른 다양한 그래프를 지원하고 다양한 스크린과
슬라이드 쇼를 이용해 대시보드 구현할 수 있다.

  - 모니터링 된 항목을 내장된 그래프 기능을 사용하여 즉시 그래프로
표현할 수 있음.

- 웹 모니터링

  - 웹 사이트에서 시뮬레이션 된 마우스 클릭 경로를 따라 기능 및
응답시간을 확인할 수 있음.

- 데이터 저장

  - 수집한 데이터를 MySQL 등의 데이터베이스에 저장
  
  - 데이터 저장 기간을 자유롭게 구성할 수 있고, 데이터베이스 백업
기능이 지원됨.

- 쉬운 구성

  - 모니터링 된 장치 추가

- 템플릿 사용

  - 템플릿을 사용해 검사 시간을 절약할 수 있음.
  
  - 다른 템플릿을 상속할 수 있는 템플릿

- 네트워크 발견

  - 네트워크 장치를 자동 검색
  - 에이전트를 자동으로 등록하고, 파일 시스템, 네트워크 인터페이스 및
SNMP OID 발견

- 빠른 웹 인터페이스
  
  - PHP 웹 기반 프론트 엔드
  
  - 어디서든 액세스 할 수 있는 장점.

- Zabbix API
  
  - 대량 조작, 타사 소프트웨어 통합 등의 목적을 위해 Zabbix 에
프로그래밍 가능 인터페이스를 제공한다.

- 사용 권한 시스템

  - 시스템에 대한 사용자의 권한을 설정해서 특정 사용자를 특정 뷰에
한정할 수 있다.

- 모든 기능을 갖춘, 쉽게 확장 가능한 에이전트

  - Linux 와 Windonws 모두에 배포 가능

- 복잡한 환경에 대비

  - zabbix 프록시를 사용해 원격 모니터링을 쉽게 할 수 있음.

---

**4) 구조**

**- Server + Web Interface + Proxy + Agent + Database**

- Server
  
  - 모니터링을 수행하는 중앙 프로세스이자 데이터 저장소
  
  - 가용성 및 무결성 정보 제공
  
  - 통계 데이터, 설정 데이터 저장.

- Web Interface

  - zabbix Access Interface 제공
  
  - 설치시 APM 사전 설치 필요

- Proxy
  
  - zabbix 서버의 부하 분산에 사용
  
  - 서버를 대신하여 성능/가용성 데이터 수집

- Agent
  
  - 리소스와 애플리케이션 모니터링
  
  - 수집 데이터를 Database 에 전송

---

![image](https://user-images.githubusercontent.com/108641325/196740367-384e3d6c-5b38-446c-97fa-748ea565e5a3.png)

- Host: 수집 대상의 논리적인 단위.
서버, 네트워크 장비, 특정 네트워크 장비의 일부 아이템 등이 그 대상이
될 수 있다(Item 은 수집 항목. CPU 나 메모리 사용량 등).

- Trigger/Event: 임계치 설정/임계치 도달 시 발생
CPU 가 90% 사용됐을 때 이벤트를 발생시켜라 등. 이런 임계치가 되면
이벤트가 발생한다.

- Condition: 이벤트가 발생할 수 있는 조건들.

- 전체적인 순서: 설정해놓은 임계치가 되면 Trigger 가 동작하며 Event 를
발생시키고, Condition(조건)에 맞춰 Operation 을 발생시킨다. SMA/E-mail 
발송 등을 Operation 을 통해 설정할 수 있다.

- 템플릿: 수집(감시)항목들의 세트

---

**5) SNMP(Simple Network Management Protocol)**

- 개념

  - IP 기반 네트워크 상 각 호스트로부터 정기적으로 여러 관리 정보를
자동으로 수집, 실시간으로 상태를 모니터링 및 설정할 수 있는
서비스로 시스템이나 네트워크 관리자가 원격으로 네트워크 장비를
모니터링하고 환경설정 등의 운영을 할 수 있게 해주는 네트워크 관리
프로토콜.

  - SNMP 는 프로토콜일 뿐이며, 이를 활용해 실제 네트워크 관리정보를
얻기 위해서는 관련 프로그램이 있어야 함.

- 약점

  - 관리의 편의성을 주지만, 여러 취약점이 존재. 서비스 거부 공격(DoS), 
버퍼 오버플로우, 비인가 접속 등이 그것.

- 구성
  - 관리 시스템과 관리 대상으로 구성
관리 시스템은 Manager, 관리 대상은 Agent 라고 부른다.

  - SNMP Manager 은 Agent 에 필요한 정보를 요청하는 모듈. SNMP 
Agent 는 관리 대상 시스템에 설치되어 필요한 정보를 수집, 
Manager 에게 전달해주는 역할을 수행하는 모듈.

  - 네트워크 관리를 위한 목적으로 주로 서버나 네트워크 장비에서
SNMP 를 설정한 MRGT 프로그램을 이용해 트래픽 관리 등을 위해
사용된다.

  - MRGT(Multiple Router Traffic Grapher): SNMP 기반의 장비 모니터링
프로그램. 주 용도는 네트워크 트래픽 사용량 모니터링이지만, 
벤더에서 제고하는 MIB 값을 사용해 다양한 정보 수집 가능.

  - SNMP 는 OSI 7 계층으로 Application 계층 프로토콜. 메시지는 단순히
요청과 응답 형식의 프로토콜에 의해 교환되기 때문에 전송계층
프로토콜로 UDP 프로토콜 사용.

- MIB

  - MIB(Management Information Base): 관리되어야 할 정보, 자원을
객체라하고, 이러한 객체들을 모아놓은 집합체를 MIB 라고 함. 즉
관리자가 조회하거나 설정할 수 있는 객체들의 데이터베이스.
MIB 는 객체별로 트리 형식의 구조를 이룸. 정보값을 문자로 표현

  - OID(Object Identifier): 정보값을 숫자로 표현
